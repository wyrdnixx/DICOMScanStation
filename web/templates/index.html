<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{.title}}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .scanner-card {
            transition: all 0.3s ease;
        }
        .scanner-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        .file-thumbnail {
            max-width: 150px;
            max-height: 150px;
            object-fit: cover;
            border-radius: 8px;
            cursor: pointer;
            transition: transform 0.2s ease;
        }
        .file-thumbnail:hover {
            transform: scale(1.05);
        }
        .modal-image {
            max-width: 100%;
            max-height: 80vh;
        }
        .status-connected {
            color: #28a745;
        }
        .status-disconnected {
            color: #dc3545;
        }
        .scanner-selected {
            background-color: #e3f2fd !important;
            border-color: #2196f3 !important;
        }
        .loading {
            display: none;
        }
        .loading.show {
            display: block;
        }
    </style>
</head>
<body>
    <div class="container-fluid">
        <div class="row">
            <!-- Header -->
            <div class="col-12 bg-primary text-white p-3">
                <h1 class="mb-0">
                    <i class="fas fa-scanner"></i> {{.title}}
                </h1>
                <p class="mb-0">{{.config.WebDescription}}</p>
            </div>
        </div>

        <div class="row mt-4">
            <!-- Scanner Status -->
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5><i class="fas fa-scanner"></i> Scanner Status</h5>
                    </div>
                    <div class="card-body">
                        <div id="scanners-container">
                            <div class="text-center">
                                <div class="spinner-border" role="status">
                                    <span class="visually-hidden">Loading...</span>
                                </div>
                                <p>Loading scanners...</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Scan Control -->
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5><i class="fas fa-camera"></i> Scan Control</h5>
                    </div>
                    <div class="card-body">
                        <div id="scan-control">
                            <div class="text-center">
                                <p>No connected scanners available</p>
                            </div>
                        </div>
                        
                        <!-- Scan Options (initially hidden) -->
                        <div id="scan-options" style="display: none;">
                            <hr>
                            <h6><i class="fas fa-cog"></i> Scan Options</h6>
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="multiPage" checked>
                                        <label class="form-check-label" for="multiPage">
                                            Multi-page scanning
                                        </label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="duplex">
                                        <label class="form-check-label" for="duplex">
                                            Duplex (both sides)
                                        </label>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="color" checked>
                                        <label class="form-check-label" for="color">
                                            Color scanning
                                        </label>
                                    </div>
                                    <div class="mb-3">
                                        <label for="resolution" class="form-label">Resolution (DPI)</label>
                                        <select class="form-select" id="resolution">
                                            <option value="150">150 DPI</option>
                                            <option value="300" selected>300 DPI</option>
                                            <option value="600">600 DPI</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- PACs-Daten -->
        <div class="row mt-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h5><i class="fas fa-database"></i> PACs-Daten</h5>
                    </div>
                    <div class="card-body">
                        <!-- Search Box -->
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="pacs-search" class="form-label">Patient Search:</label>
                                <div class="input-group">
                                    <input type="text" class="form-control" id="pacs-search" placeholder="Enter patient name or ID...">
                                    <button class="btn btn-outline-primary" type="button" onclick="searchPacs()">
                                        <i class="fas fa-search"></i> Search
                                    </button>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <label for="document-creator" class="form-label">Dokument Ersteller:</label>
                                <input type="text" class="form-control" id="document-creator" placeholder="Enter document creator name...">
                            </div>
                        </div>

                        <!-- Search Results Table -->
                        <div class="row mb-3">
                            <div class="col-12">
                                <div class="table-responsive">
                                    <table class="table table-striped table-hover" id="pacs-results-table">
                                        <thead class="table-dark">
                                            <tr>
                                                <th>
                                                    <input type="checkbox" class="form-check-input" id="select-all-pacs">
                                                </th>
                                                <th>Patient ID</th>
                                                <th>Name</th>
                                                <th>Birth Date</th>
                                                <th>Gender</th>
                                                <th>Study Date</th>
                                            </tr>
                                        </thead>
                                        <tbody id="pacs-results-body">
                                            <!-- Search results will be populated here -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>

                        <!-- Send Button -->
                        <div class="row">
                            <div class="col-12">
                                <button class="btn btn-success btn-lg" onclick="sendToPacs()">
                                    <i class="fas fa-paper-plane"></i> An PACs senden
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Scanned Files -->
        <div class="row mt-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h5><i class="fas fa-images"></i> Scanned Files</h5>
                        <button class="btn btn-outline-danger btn-sm" onclick="clearAllFiles()">
                            <i class="fas fa-trash"></i> Clear All
                        </button>
                    </div>
                    <div class="card-body">
                        <div id="files-container">
                            <div class="text-center">
                                <div class="spinner-border" role="status">
                                    <span class="visually-hidden">Loading...</span>
                                </div>
                                <p>Loading files...</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Image Modal -->
    <div class="modal fade" id="imageModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Document View</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body text-center">
                    <img id="modal-image" class="modal-image" src="" alt="Document">
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-danger" onclick="deleteCurrentFile()">
                        <i class="fas fa-trash"></i> Delete
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container position-fixed top-0 end-0 p-3" style="z-index: 1055;">
        <div id="toast" class="toast" role="alert" aria-live="assertive" aria-atomic="true">
            <div class="toast-header">
                <i id="toast-icon" class="fas me-2"></i>
                <strong id="toast-title" class="me-auto">Notification</strong>
                <button type="button" class="btn-close" data-bs-dismiss="toast"></button>
            </div>
            <div id="toast-body" class="toast-body">
                <!-- Toast message will be inserted here -->
            </div>
        </div>
    </div>

    <!-- Confirmation Modal -->
    <div class="modal fade" id="confirmModal" tabindex="-1" aria-labelledby="confirmModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="confirmModalLabel">
                        <i id="confirm-icon" class="fas fa-question-circle me-2"></i>
                        <span id="confirm-title">Confirm Action</span>
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <p id="confirm-message">Are you sure you want to perform this action?</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-danger" id="confirm-action-btn">Confirm</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        let currentFiles = [];
        let currentFilename = '';
        let selectedScanner = '';

        let isScanning = false;
        let scannerRefreshInterval;
        let filesRefreshInterval;

        // Toast notification function
        function showToast(type, title, message) {
            const toast = document.getElementById('toast');
            const toastIcon = document.getElementById('toast-icon');
            const toastTitle = document.getElementById('toast-title');
            const toastBody = document.getElementById('toast-body');
            
            // Set icon and color based on type
            let iconClass = 'fa-info-circle';
            let bgClass = 'bg-primary';
            
            switch(type) {
                case 'success':
                    iconClass = 'fa-check-circle';
                    bgClass = 'bg-success';
                    break;
                case 'error':
                    iconClass = 'fa-exclamation-circle';
                    bgClass = 'bg-danger';
                    break;
                case 'warning':
                    iconClass = 'fa-exclamation-triangle';
                    bgClass = 'bg-warning';
                    break;
                case 'info':
                default:
                    iconClass = 'fa-info-circle';
                    bgClass = 'bg-primary';
                    break;
            }
            
            // Update toast content
            toastIcon.className = `fas ${iconClass} me-2`;
            toastTitle.textContent = title;
            toastBody.textContent = message;
            
            // Update toast background
            toast.className = `toast ${bgClass} text-white`;
            
            // Show the toast
            const bsToast = new bootstrap.Toast(toast);
            bsToast.show();
        }

        // Confirmation modal function
        function showConfirm(title, message, icon, action) {
            const confirmModal = document.getElementById('confirmModal');
            const confirmIcon = document.getElementById('confirm-icon');
            const confirmTitle = document.getElementById('confirm-title');
            const confirmMessage = document.getElementById('confirm-message');
            const confirmBtn = document.getElementById('confirm-action-btn');
            
            // Update modal content
            confirmIcon.className = `fas ${icon} me-2`;
            confirmTitle.textContent = title;
            confirmMessage.textContent = message;
            
            // Set up the action button
            confirmBtn.onclick = () => {
                action();
                bootstrap.Modal.getInstance(confirmModal).hide();
            };
            
            // Show the modal
            const modal = new bootstrap.Modal(confirmModal);
            modal.show();
        }

        // Load data on page load
        document.addEventListener('DOMContentLoaded', function() {
            loadScanners();
            loadFiles();
            
            // Refresh data every 5 seconds
            scannerRefreshInterval = setInterval(loadScanners, 5000);
            filesRefreshInterval = setInterval(loadFiles, 5000);
        });

        function loadScanners() {
            fetch('/api/scanners')
                .then(response => response.json())
                .then(data => {
                    updateScannersUI(data.scanners);
                })
                .catch(error => {
                    console.error('Error loading scanners:', error);
                });
        }

        function updateScannersUI(scanners) {
            const container = document.getElementById('scanners-container');
            const scanControl = document.getElementById('scan-control');
            
            if (scanners.length === 0) {
                container.innerHTML = '<p class="text-muted">No scanners detected</p>';
                scanControl.innerHTML = '<p class="text-muted">No connected scanners available</p>';
                return;
            }

            let scannersHTML = '';
            let scanControlHTML = '';
            let connectedScanners = [];

            scanners.forEach(scanner => {
                const statusClass = scanner.connected ? 'status-connected' : 'status-disconnected';
                const statusIcon = scanner.connected ? 'fa-check-circle' : 'fa-times-circle';
                const isSelected = selectedScanner === scanner.device;
                const selectedClass = isSelected ? 'scanner-selected' : '';
                
                scannersHTML += `
                    <div class="scanner-card card mb-3 ${selectedClass}" onclick="selectScanner('${scanner.device}')" style="cursor: pointer;">
                        <div class="card-body">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <h6 class="mb-1">${scanner.name}</h6>
                                    <small class="text-muted">${scanner.device}</small>
                                </div>
                                <div class="text-end">
                                    <i class="fas ${statusIcon} ${statusClass}"></i>
                                    <br>
                                    <small class="text-muted">${scanner.status}</small>
                                </div>
                            </div>
                        </div>
                    </div>
                `;

                if (scanner.connected) {
                    connectedScanners.push(scanner);
                }
            });

            // Generate scan control based on connected scanners
            if (connectedScanners.length === 0) {
                scanControlHTML = '<p class="text-muted text-center">No connected scanners available</p>';
                document.getElementById('scan-options').style.display = 'none';
            } else if (connectedScanners.length === 1) {
                const scanner = connectedScanners[0];
                const isSelected = selectedScanner === scanner.device;
                const buttonClass = isSelected ? 'btn-primary' : 'btn-outline-primary';
                const buttonText = isSelected ? 'Selected Scanner' : 'Select Scanner';
                
                scanControlHTML = `
                    <div class="text-center">
                        <p>Ready to scan with: <strong>${scanner.name}</strong></p>
                        <button class="btn ${buttonClass} btn-lg" onclick="startScan('${scanner.device}')">
                            <i class="fas fa-camera"></i> ${buttonText}
                        </button>
                    </div>
                `;
                
                if (isSelected) {
                    document.getElementById('scan-options').style.display = 'block';
                } else {
                    document.getElementById('scan-options').style.display = 'none';
                }
            } else {
                // Multiple connected scanners
                const selectedScannerObj = connectedScanners.find(s => s.device === selectedScanner);
                if (selectedScannerObj) {
                    scanControlHTML = `
                        <div class="text-center">
                            <p>Selected scanner: <strong>${selectedScannerObj.name}</strong></p>
                            <button class="btn btn-primary btn-lg" onclick="startScan('${selectedScannerObj.device}')">
                                <i class="fas fa-camera"></i> Start Scan
                            </button>
                        </div>
                    `;
                    document.getElementById('scan-options').style.display = 'block';
                } else {
                    scanControlHTML = `
                        <div class="text-center">
                            <p class="text-muted">Click on a scanner above to select it</p>
                            <button class="btn btn-outline-secondary btn-lg" disabled>
                                <i class="fas fa-camera"></i> Select Scanner First
                            </button>
                        </div>
                    `;
                    document.getElementById('scan-options').style.display = 'none';
                }
            }

            container.innerHTML = scannersHTML;
            if (scanControlHTML) {
                scanControl.innerHTML = scanControlHTML;
            }
        }

        function loadFiles() {
            fetch('/api/files')
                .then(response => response.json())
                .then(data => {
                    currentFiles = data.files;
                    updateFilesUI(data.files);
                })
                .catch(error => {
                    console.error('Error loading files:', error);
                });
        }

        function updateFilesUI(files) {
            const container = document.getElementById('files-container');
            
            if (isScanning) {
                container.innerHTML = `
                    <div class="text-center">
                        <div class="spinner-border text-primary" role="status">
                            <span class="visually-hidden">Scanning...</span>
                        </div>
                        <p class="mt-2">Scanning in progress...</p>
                    </div>
                `;
                return;
            }
            
            if (files.length === 0) {
                container.innerHTML = '<p class="text-muted text-center">No scanned files found</p>';
                return;
            }

            let filesHTML = '<div class="row">';
            files.forEach(file => {
                filesHTML += `
                    <div class="col-md-3 col-sm-6 mb-3">
                        <div class="card">
                            <div class="card-body text-center">
                                <img src="/api/files/${file.name}" 
                                     class="file-thumbnail mb-2" 
                                     onclick="viewImage('${file.name}')"
                                     alt="${file.name}">
                                <h6 class="card-title">${file.name}</h6>
                                <p class="card-text">
                                    <small class="text-muted">
                                        ${formatFileSize(file.size)}<br>
                                        ${file.modified_time}
                                    </small>
                                </p>
                                <button class="btn btn-outline-danger btn-sm" onclick="deleteFile('${file.name}')">
                                    <i class="fas fa-trash"></i> Delete
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            });
            filesHTML += '</div>';
            container.innerHTML = filesHTML;
        }

        function selectScanner(device) {
            selectedScanner = device;
            loadScanners(); // Refresh the UI to show selection
            
            // Show scan options when a scanner is selected
            const scanOptions = document.getElementById('scan-options');
            if (scanOptions) {
                scanOptions.style.display = 'block';
            }
        }

        function startScan(device) {
            // Auto-select the scanner if none is selected
            if (!selectedScanner && device) {
                selectedScanner = device;
            }
            
            const button = event.target;
            const originalText = button.innerHTML;
            
            button.disabled = true;
            button.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Scanning...';
            
            // Pause auto-refresh during scanning
            isScanning = true;
            clearInterval(filesRefreshInterval);

            // Get scan options
            const options = {
                multi_page: document.getElementById('multiPage').checked,
                duplex: document.getElementById('duplex').checked,
                color: document.getElementById('color').checked,
                resolution: parseInt(document.getElementById('resolution').value)
            };

            fetch('/api/scan', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ 
                    device: device,
                    options: options
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.error) {
                    showToast('error', 'Scan Failed', 'Scan failed: ' + data.error);
                } else {
                    const pageText = data.pages === 1 ? 'page' : 'pages';
                    showToast('success', 'Scan Completed', `Scan completed successfully! Scanned ${data.pages} ${pageText}.`);
                    // Add a delay to ensure files are fully written before refreshing
                    setTimeout(() => {
                        loadFiles();
                    }, 1000);
                }
            })
            .catch(error => {
                console.error('Error:', error);
                showToast('error', 'Scan Failed', 'Scan failed: ' + error.message);
            })
            .finally(() => {
                button.disabled = false;
                button.innerHTML = originalText;
                
                // Resume auto-refresh after scanning
                isScanning = false;
                filesRefreshInterval = setInterval(loadFiles, 5000);
            });
        }

        function viewImage(filename) {
            currentFilename = filename;
            const modal = new bootstrap.Modal(document.getElementById('imageModal'));
            document.getElementById('modal-image').src = `/api/files/${filename}`;
            modal.show();
        }

        function deleteFile(filename) {
            showConfirm(
                'Delete File',
                `Are you sure you want to delete "${filename}"?`,
                'fa-trash',
                () => {
                    // Immediately remove the file from the UI for better responsiveness
                    currentFiles = currentFiles.filter(file => file.name !== filename);
                    updateFilesUI(currentFiles);
                    
                    fetch(`/api/files/${filename}`, {
                        method: 'DELETE'
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.error) {
                            showToast('error', 'Delete Failed', 'Delete failed: ' + data.error);
                            // Reload files if deletion failed
                            loadFiles();
                        } else {
                            showToast('success', 'File Deleted', 'File deleted successfully!');
                            // Double-check with server to ensure UI is in sync
                            setTimeout(() => {
                                loadFiles();
                            }, 100);
                        }
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        showToast('error', 'Delete Failed', 'Delete failed: ' + error.message);
                        // Reload files if deletion failed
                        loadFiles();
                    });
                }
            );
        }

        function deleteCurrentFile() {
            if (currentFilename) {
                deleteFile(currentFilename);
                bootstrap.Modal.getInstance(document.getElementById('imageModal')).hide();
            }
        }

        function clearAllFiles() {
            if (currentFiles.length === 0) {
                showToast('warning', 'No Files', 'No files to clear');
                return;
            }

            showConfirm(
                'Delete All Files',
                `Are you sure you want to delete all ${currentFiles.length} files?`,
                'fa-trash-alt',
                () => {
                    // Store the files to delete before clearing the UI
                    const filesToDelete = [...currentFiles];
                    
                    // Immediately clear the UI for better responsiveness
                    currentFiles = [];
                    updateFilesUI(currentFiles);
                    
                    const deletePromises = filesToDelete.map(file => 
                        fetch(`/api/files/${file.name}`, { method: 'DELETE' })
                    );

                    Promise.all(deletePromises)
                        .then(() => {
                            showToast('success', 'All Files Deleted', 'All files deleted successfully!');
                            // Double-check with server to ensure UI is in sync
                            setTimeout(() => {
                                loadFiles();
                            }, 100);
                        })
                        .catch(error => {
                            console.error('Error:', error);
                            showToast('error', 'Delete Failed', 'Failed to delete some files');
                            // Reload files if deletion failed
                            loadFiles();
                        });
                }
            );
        }

        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        // PACs functionality
        function searchPacs() {
            const searchTerm = document.getElementById('pacs-search').value.trim();
            if (!searchTerm) {
                showToast('warning', 'Search Error', 'Please enter a search term');
                return;
            }

            // Show loading state
            const tbody = document.getElementById('pacs-results-body');
            tbody.innerHTML = '<tr><td colspan="6" class="text-center"><div class="spinner-border" role="status"></div><p>Searching...</p></td></tr>';

            // Simulate PACs search (replace with actual API call)
            setTimeout(() => {
                // Mock data for demonstration
                const mockResults = [
                    { patientId: 'P001', name: 'Max Mustermann', birthDate: '1980-05-15', gender: 'M', studyDate: '2024-01-15' },
                    { patientId: 'P002', name: 'Anna Schmidt', birthDate: '1975-12-03', gender: 'F', studyDate: '2024-01-14' },
                    { patientId: 'P003', name: 'Hans Mueller', birthDate: '1990-08-22', gender: 'M', studyDate: '2024-01-13' }
                ];

                displayPacsResults(mockResults);
                showToast('success', 'Search Complete', `Found ${mockResults.length} patients`);
            }, 1000);
        }

        function displayPacsResults(results) {
            const tbody = document.getElementById('pacs-results-body');
            tbody.innerHTML = '';

            if (results.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" class="text-center text-muted">No patients found</td></tr>';
                return;
            }

            results.forEach((patient, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td><input type="checkbox" class="form-check-input pacs-checkbox" value="${patient.patientId}"></td>
                    <td>${patient.patientId}</td>
                    <td>${patient.name}</td>
                    <td>${patient.birthDate}</td>
                    <td>${patient.gender}</td>
                    <td>${patient.studyDate}</td>
                `;
                tbody.appendChild(row);
            });
        }

        function sendToPacs() {
            const selectedPatients = Array.from(document.querySelectorAll('.pacs-checkbox:checked')).map(cb => cb.value);
            const documentCreator = document.getElementById('document-creator').value.trim();

            if (selectedPatients.length === 0) {
                showToast('warning', 'No Selection', 'Please select at least one patient');
                return;
            }

            if (!documentCreator) {
                showToast('warning', 'Missing Information', 'Please enter the document creator name');
                return;
            }

            if (currentFiles.length === 0) {
                showToast('warning', 'No Files', 'Please scan some documents first');
                return;
            }

            showConfirm(
                'Send to PACs',
                `Send ${currentFiles.length} document(s) to ${selectedPatients.length} selected patient(s)?`,
                'fa-paper-plane',
                () => {
                    // Show loading state
                    const button = event.target;
                    const originalText = button.innerHTML;
                    button.disabled = true;
                    button.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Sending...';

                    // Simulate sending to PACs (replace with actual API call)
                    setTimeout(() => {
                        button.disabled = false;
                        button.innerHTML = originalText;
                        showToast('success', 'Sent to PACs', 'Documents successfully sent to PACs!');
                        
                        // Clear selections
                        document.querySelectorAll('.pacs-checkbox').forEach(cb => cb.checked = false);
                        document.getElementById('select-all-pacs').checked = false;
                    }, 2000);
                }
            );
        }

        // Select all functionality for PACs table
        document.addEventListener('DOMContentLoaded', function() {
            const selectAllCheckbox = document.getElementById('select-all-pacs');
            if (selectAllCheckbox) {
                selectAllCheckbox.addEventListener('change', function() {
                    const checkboxes = document.querySelectorAll('.pacs-checkbox');
                    checkboxes.forEach(cb => cb.checked = this.checked);
                });
            }
        });
    </script>
</body>
</html> 